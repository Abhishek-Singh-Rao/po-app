<mvc:View
    controllerName="com.ycl.purchaseorder.controller.Detail"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:uxap="sap.uxap"
    xmlns:m="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:forms="sap.ui.layout.form"
    height="100%"
>
    <uxap:ObjectPageLayout
        id="ObjectPageLayout"
        upperCaseAnchorBar="false"
        showFooter="true"
    >
        <!-- Object Page Header Title -->
        <uxap:headerTitle>
            <uxap:ObjectPageDynamicHeaderTitle>
                <uxap:expandedHeading>
                    <m:VBox>
                        <m:Title
                            text="{= ${viewModel>/isEditMode} &amp;&amp; !${ID} ? 'New Purchase Order' : ${Description} }" />
                        <m:Text
                            text="{= ${viewModel>/isEditMode} &amp;&amp; !${ID} ? '' : 'PO-' + ${ID} }" />
                    </m:VBox>
                </uxap:expandedHeading>

                <uxap:snappedHeading>
                    <m:Title text="{= ${viewModel>/isEditMode} &amp;&amp; !${ID} ? 'New Purchase Order' : ${Description} }" />
                </uxap:snappedHeading>

                <uxap:snappedTitleOnMobile>
                    <m:Title text="{= ${viewModel>/isEditMode} &amp;&amp; !${ID} ? 'New Purchase Order' : ${Description} }" />
                </uxap:snappedTitleOnMobile>

                <uxap:actions>
                    <!-- <m:Button icon="sap-icon://nav-back" press=".onNavBack" tooltip="Back" /> -->
                    <m:Button
                        text="Edit"
                        type="Emphasized"
                        press="onEdit"
                        visible="{viewModel>/isDisplayMode}"
                    />
                </uxap:actions>
            </uxap:ObjectPageDynamicHeaderTitle>
        </uxap:headerTitle>

        <!-- Object Page Header Content -->
        <uxap:headerContent>
            <m:FlexBox
                wrap="Wrap"
                fitContainer="true"
            >
                <!-- Horizontal Container 1 -->
                <m:HBox
                    justifyContent="Start"
                    class="sapUiSmallMarginBegin sapUiMediumMarginTop"
                    renderType="Bare"
                >
                    <m:VBox class="sapUiMarginEnd sapUiSmallMarginBottom">
                        <!-- PO Number -->
                        <m:HBox
                            renderType="Bare"
                            class="sapUiTinyMarginBottom"
                        >
                            <m:Label
                                text="PO Number :"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:Text text="{ID}" />
                        </m:HBox>

                        <!-- Company Code -->
                        <m:HBox
                            renderType="Bare"
                            class="sapUiTinyMarginBottom"
                        >
                            <m:Label
                                text="Company Name :"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:Link
                                text="{
                                    parts: ['Company/Code', 'Company/Description'],
                                    formatter: '.formatKeyValue'
                                }"
                            />
                        </m:HBox>

                        <!-- Vendor -->
                        <m:HBox
                            renderType="Bare"
                            class="sapUiTinyMarginBottom"
                        >
                            <m:Label
                                text="Vendor Name :"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:Link
                                text="{
                                    parts: ['Vendor/Number', 'Vendor/Description'],
                                    formatter: '.formatKeyValue'
                                }"
                                />
                        </m:HBox>
                    </m:VBox>

                    <!-- Description -->
                    <m:VBox
                        class="sapUiLargeMarginBegin sapUiLargeMarginEnd sapUiSmallMarginBottom"
                    >
                        <m:Title text="PO Description" />
                        <m:ObjectStatus
                            text="{Description}"
                            state="Error"
                            class="sapMObjectStatusLarge"
                        />
                    </m:VBox>

                    <!-- Document Type -->
                    <m:VBox
                        class="sapUiLargeMarginBegin sapUiLargeMarginEnd sapUiSmallMarginBottom"
                        width="450px"
                    >
                        <m:Title text="PO Document Type" />
                        <m:ObjectStatus
                            text="{DocumentType/Description} ({DocumentType_ID})"
                            class="sapMObjectStatusLarge"
                        />
                    </m:VBox>

                    <!-- Amount -->
                    <m:VBox
                        class="sapUiLargeMarginBegin sapUiLargeMarginEnd sapUiSmallMarginBottom"
                    >
                        <m:Title text="Total Amount" />
                        <m:ObjectNumber
                            id="totalAmountNumber"
                            number="0.00"
                            unit="INR"
                            state="Success"
                            class="sapMObjectNumberLarge"
                        />
                    </m:VBox>
                </m:HBox>

                <!-- Horizontal Container 2 -->
                <m:HBox
                    justifyContent="Start"
                    class="sapUiSmallMarginBegin"
                    renderType="Bare"
                >
                    <m:VBox
                        class="sapUiLargeMarginEnd sapUiSmallMarginBottom"
                        width="535px"
                    >
                        <!-- Created By -->
                        <m:HBox
                            class="sapUiTinyMarginBottom"
                            renderType="Bare"
                        >
                            <m:Label text="Created By :" />
                            <m:Text
                                text="{ parts: ['createdBy'], formatter: '.toProperCase' }"
                                class="sapUiTinyMarginBegin"
                            />
                        </m:HBox>

                        <!-- Created On -->
                        <m:HBox
                            class="sapUiTinyMarginBottom"
                            renderType="Bare"
                        >
                            <m:Label text="Created On :" />
                            <m:Text
                                text="{createdAt}"
                                class="sapUiTinyMarginBegin"
                            />
                        </m:HBox>
                    </m:VBox>

                    <m:VBox
                        class="sapUiLargeMarginBegin sapUiLargeMarginEnd sapUiSmallMarginBottom"
                    >
                        <!-- Modified By -->
                        <m:HBox
                            class="sapUiTinyMarginBottom"
                            renderType="Bare"
                        >
                            <m:Label text="Modified By :" />
                            <m:Text
                                text="{ parts: ['modifiedBy'], formatter: '.toProperCase' }"
                                class="sapUiTinyMarginBegin"
                            />
                        </m:HBox>
                        <!-- Modified On -->
                        <m:HBox
                            class="sapUiTinyMarginBottom"
                            renderType="Bare"
                        >
                            <m:Label text="Modified On :" />
                            <m:Text
                                text="{modifiedAt}"
                                class="sapUiTinyMarginBegin"
                            />
                        </m:HBox>
                    </m:VBox>
                </m:HBox>
            </m:FlexBox>
        </uxap:headerContent>

        <uxap:sections>
            <uxap:ObjectPageSection title="Purchase Order Details">
                <uxap:subSections>
                    <uxap:ObjectPageSubSection>
                        <uxap:blocks>
                            <forms:SimpleForm
                                id="SimpleFormDisplay480_Trial"
                                editable="true"
                                layout="ResponsiveGridLayout"
                                title="Purchase Order Details"
                                labelSpanXL="4"
                                labelSpanL="4"
                                labelSpanM="4"
                                labelSpanS="12"
                                adjustLabelSpan="false"
                                emptySpanXL="0"
                                emptySpanL="0"
                                emptySpanM="0"
                                emptySpanS="0"
                                columnsXL="3"
                                columnsL="2"
                                columnsM="2"
                                singleContainerFullSize="false"
                            >
                                <forms:content>
                                    <!-- PO Number -->
                                    <m:Label text="Purchase Order No."/>
                                        <m:HBox>
                                            <!-- EXISTING orders (display OR edit): show read‑only text -->
                                            <m:Text text="{ID}"
                                                    visible="{= !${viewModel>/isCreateMode} }"/>

                                            <!-- NEW order while in edit‑mode: let user type the key -->
                                            <m:Input value="{ID}"
                                                    width="10rem"
                                                    placeholder="Enter PO Number"
                                                    visible="{= ${viewModel>/isCreateMode} }"/>
                                        </m:HBox>

                                    <!-- Company Code -->
                                    <m:Label text="Company Name" />
                                    <m:HBox>
                                        <m:Text
                                            text="{
                                                parts:['Company/Code', 'Company/Description'],
                                                formatter: '.formatKeyValue'
                                            }"
                                            visible="{viewModel>/isDisplayMode}"
                                        />
                                        <m:Select
                                            visible="{viewModel>/isEditMode}"
                                            selectedKey="{Company_Code}"
                                            items="{/Company}"
                                            width="13rem"
                                            
                                        >
                                            <core:Item
                                                key="{Code}"
                                                text="{
                                                    parts: ['Code', 'Description'],
                                                    formatter: '.formatKeyValue'
                                                }"
                                            />
                                        </m:Select>
                                    </m:HBox>

                                    <!-- Vendor Description -->
                                    <m:Label text="Vendor Name" />
                                    <m:HBox>
                                    <m:Text
                                        text="{
                                                parts:['Vendor/Number', 'Vendor/Description'],
                                                formatter: '.formatKeyValue'
                                            }"
                                        visible="{viewModel>/isDisplayMode}"
                                    />
                                    <m:Input
                                        id="vendorInput"
                                        visible="{viewModel>/isEditMode}"
                                        width="13rem"
                                        showValueHelp="true"
                                        valueHelpRequest=".onVendorValueHelp"
                                        placeholder="Select Vendor"
                                        value="{
                                            parts: [
                                                { path: 'Vendor/Number' },
                                                { path: 'Vendor/Description' }
                                            ],
                                            formatter: '.formatKeyValue'
                                        }"
                                    />

                                    </m:HBox>

                                    <!-- Description -->
                                    <m:Label text="PO Description" />
                                    <m:HBox>
                                    <m:Text
                                        text="{Description}"
                                        visible="{viewModel>/isDisplayMode}"
                                    />
                                    <m:Input
                                        value="{Description}"
                                        width="13rem"
                                        visible="{viewModel>/isEditMode}"
                                        placeholder="Enter Description"
                                    />
                                    </m:HBox>

                                    <!-- Document Type -->
                                    <m:Label text="Document Type" />
                                    <m:HBox>
                                    <m:Text
                                        text="{
                                                parts:['DocumentType/ID', 'DocumentType/Description'],
                                                formatter: '.formatKeyValue'
                                            }"
                                        visible="{viewModel>/isDisplayMode}"
                                    />
                                    <m:Select
                                        visible="{viewModel>/isEditMode}"
                                        width="13rem"
                                        selectedKey="{DocumentType_ID}"
                                        items="{
                                            path: '/DocumentType',
                                            parameters: {
                                                $orderby: 'ID'
                                            }
                                        }"
                                    >
                                        <core:Item
                                            key="{ID}"
                                            text="{
                                                parts:['ID', 'Description'],
                                                formatter: '.formatKeyValue'
                                            }"
                                        />
                                    </m:Select>
                                    </m:HBox>
                                </forms:content>
                            </forms:SimpleForm>
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
        </uxap:sections>

        <!-- Sections -->
        <uxap:sections>
            <uxap:ObjectPageSection title="Header">
                <uxap:ObjectPageSubSection />
            </uxap:ObjectPageSection>
            <uxap:ObjectPageSection title="Items">
                <uxap:subSections>
                    <uxap:ObjectPageSubSection>
                        <!-- <actions>
                            <m:HBox
                                justifyContent="SpaceBetween"
                                width="100%"
                            >
                                <m:Title
                                    text="ITEM DETAILS"
                                    titleStyle="H4"
                                />
                                <m:HBox
                                    visible="{viewModel>/isEditMode}"
                                    alignItems="Center"
                                >
                                    <m:Button
                                        text="Add"
                                        press=".onCreateRow"
                                        type="Transparent"
                                    />
                                    <m:Button
                                        text="Delete"
                                        press=".onDeleteRow"
                                        type="Transparent"
                                    />
                                </m:HBox>
                            </m:HBox>
                        </actions> -->
                        <uxap:blocks>
                            <m:Table
                                id="ItemsTable"
                                mode="{ path: 'viewModel>/isEditMode', formatter: '.formatTableMode' }"
                                includeItemInSelection="true"
                                items="{ path: 'Items' }"
                                class="sapUxAPObjectPageSubSectionAlignContent"
                            >
                                <m:headerToolbar>
                                    <m:OverflowToolbar>
                                        <m:ToolbarSpacer />
                                        <m:Button
                                            text="Add"
                                            press=".onCreateRow"
                                            type="Transparent"
                                            visible="{viewModel>/isEditMode}"
                                        />
                                        <m:Button
                                            text="Delete"
                                            press=".onDeleteRow"
                                            type="Transparent"
                                            visible="{viewModel>/isEditMode}"
                                        />
                                    </m:OverflowToolbar>
                                </m:headerToolbar>
                                <m:columns>
                                    <m:Column>
                                        <m:Text text="Item Number" />
                                    </m:Column>
                                    <m:Column>
                                        <m:Text text="Description" />
                                    </m:Column>
                                    <m:Column>
                                        <m:Text text="Quantity" />
                                    </m:Column>
                                    <m:Column>
                                        <m:Text text="UoM" />
                                    </m:Column>
                                    <m:Column hAlign="End">
                                        <m:Text text="Rate" />
                                    </m:Column>
                                    <m:Column hAlign="End">
                                        <m:Text text="Amount" />
                                    </m:Column>
                                </m:columns>
                                <m:items>
                                    <m:ColumnListItem visible="{= !${__deleted} }">
                                        <m:cells>
                                            <m:HBox justifyContent="End" width="4rem">
                                                <m:Text
                                                    text="{ItemNo}"
                                                />
                                            </m:HBox>
                                            <m:HBox>
                                                <m:Text
                                                    text="{Description}"
                                                    visible="{viewModel>/isDisplayMode}"
                                                />
                                                <m:Input
                                                    value="{Description}"
                                                     width="10rem"
                                                    visible="{viewModel>/isEditMode}"
                                                    placeholder="Enter Description"
                                                />
                                            </m:HBox>
                                            <m:HBox justifyContent="End" width="3rem">
                                                <m:Text
                                                    text="{Quantity}"
                                                    visible="{viewModel>/isDisplayMode}"
                                                />
                                                <m:Input
                                                    value="{Quantity}"
                                                    width="3rem"
                                                    textAlign="End"
                                                    liveChange=".onItemValueChange"
                                                    visible="{viewModel>/isEditMode}"
                                                    placeholder="Enter Quantity"
                                                />
                                            </m:HBox>
                                            <m:HBox>
                                                <m:Text
                                                    text="{Uom}"
                                                    visible="{viewModel>/isDisplayMode}"
                                                />
                                                <m:Input
                                                    value="{Uom}"
                                                     width="3rem"
                                                    visible="{viewModel>/isEditMode}"
                                                     placeholder="Enter Unit"
                                                />
                                            </m:HBox>
                                            <m:HBox justifyContent="End" width="100%">
                                                <!-- Display Mode -->
                                                <m:ObjectNumber
                                                    number="{ path: 'Rate', type: 'sap.ui.model.type.Float', formatOptions: { minFractionDigits: 2, maxFractionDigits: 2 } }"
                                                    unit="INR"
                                                    visible="{viewModel>/isDisplayMode}"
                                                />

                                                <!-- Edit Mode -->
                                                <m:Input
                                                    value="{ path: 'Rate', type: 'sap.ui.model.type.Float', formatOptions: { minFractionDigits: 2, maxFractionDigits: 2 } }"
                                                    liveChange=".onItemValueChange"
                                                    width="5rem"
                                                    textAlign="End"
                                                    visible="{viewModel>/isEditMode}"
                                                    placeholder="Enter Rate"
                                                />
                                            </m:HBox>

                                            <m:HBox justifyContent="End">
                                                <m:ObjectNumber
                                                    number="{= (${Quantity} * ${Rate}).toFixed(2) }"
                                                    unit="INR"
                                                />
                                            </m:HBox>
                                        </m:cells>
                                    </m:ColumnListItem>
                                </m:items>
                            </m:Table>
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
        </uxap:sections>
        <uxap:footer>
            <m:OverflowToolbar visible="{viewModel>/isEditMode}">
                <m:ToolbarSpacer />
                <m:Button
                    text="Save"
                    type="Emphasized"
                    press=".onSave"
                />
                <m:Button
                    text="Cancel"
                    press="onCancel"
                />
            </m:OverflowToolbar>
        </uxap:footer>
    </uxap:ObjectPageLayout>
</mvc:View>
